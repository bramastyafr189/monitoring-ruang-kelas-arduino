<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Con_manual extends CI_Controller
{
    function __construct()
    {
        parent::__construct();

        $this->load->model('Model_manual');
        $this->load->library('form_validation');        
        $this->load->library('datatables');
        $this->load->library('template');
        $this->load->library('table');
        date_default_timezone_set('Asia/Jakarta');
        if(!$this->session->userdata('user_id')){
             redirect('login_page.html');
        }
        $this->load->helper('url');
    }

    public function cek_data(){
        $ip=$this->Model_siswa->get_real_ip();
        print_r($ip);
    }

    public function dashboard_sistem_manual(){
        url_title('cek.html');
        $data['manual']=$this->Model_manual->kunci_belum_kembali();
        $this->template->display('sistem_manual/dashboard_manual',$data);
    }

    public function mengembalikan_kunci()
    {
        $id_ruang       = $this->input->get('id_ruang');
        $id_log_manual  = $this->input->get('id_log');

        //echo $id_ruang;
        //echo $id_log_manual;
        $this->Model_manual->update_status_ruang($id_ruang);
        $this->Model_manual->update_kunci_kembali_log_manual($id_log_manual);

        redirect('sistem_manual.html');
    }

    public function input_log_manual()
    {   
        $data['semester']   = $this->Model_manual->semester_aktif();
        $data['kelas']      = $this->Model_manual->getKelas();
        $this->template->display('sistem_manual/form_input_log_manual', $data);
    }

    public function exe_input_log_manual()
    {   

        //data penanggung jawab
        $peminjam = array(
                'peminjam_manual'       => $this->input->post('nama_peminjam'),
                'telp_peminjam_manual'  => $this->input->post('telp_peminjam')
                );
        
        //input penanggung jawab ruang ke database
        $id_log_manual = $this->Model_manual->input_penanggung_jawab($peminjam);

        //menampilkan makul sesuai dengan semester & kelas
        $semester       = $this->input->post('semesetr');
        $kelas          = $this->input->post('kelas');

        //memanggil makul
        $data['mapel']  = $this->Model_manual->getMapel($kelas, $semester);
        $data['ruang']  = $this->Model_manual->getRuang();
        $data['id_log'] = $id_log_manual;

        //pergi ke view
        $this->template->display('sistem_manual/input_mapel_ruang_pinjam', $data);
    }
    
    public function exe_data_peminjam_fix()
    {
        //menerima inputan dari view
        $id_log_manual = $this->input->post('id_log_manual');

        //data-data
        $data_peminjaman = array(
                        'id_log_manual'         => $id_log_manual,
                        'id_ruang_log_manual'   => $this->input->post('ruang'),
                        'id_mapel_log_manual'   => $this->input->post('mapel'),
                        'tanggal_log_manual'    => date('Y-m-d'),
                        'waktu_masuk_manual'    => date('H:i:s')
            );

        print_r($data_peminjaman);
        
        //update data 
        $this->Model_manual->data_peminjam_fix($id_log_manual, $data_peminjaman);

        //mengaktifkan ruangan yang dipakai
        $this->Model_manual->pakai_ruang($this->input->post('ruang'));


       redirect('sistem_manual.html');
    }




}




/* End of file Con_siswa.php */
/* Location: ./application/controllers/Con_siswa.php */
/* Please DO NOT modify this information : */
/* Generated by Harviacode Codeigniter CRUD Generator 2017-09-11 10:17:16 */
/* http://harviacode.com */